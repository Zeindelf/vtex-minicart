/*!!
 * VtexMinicart.js v0.2.2
 * https://github.com/zeindelf/vtex-minicart
 *
 * Copyright (c) 2017-2018 Zeindelf
 * Released under the MIT license
 *
 * Date: 2018-01-08T23:57:39.618Z
 */
!function(){"use strict";var t={vtexUtils:'VtexUtils.js is required and must be an instance. Download it from https://www.npmjs.com/package/vtex-utils and use option "vtexUtils: new VTEX.VtexUtils()".',debug:'Option debug should be a "boolean" value.',bodyClass:'Option bodyClass should be a "string" value.'},e={vtexUtils:null,debug:!1,bodyClass:null},n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=new(function(){function t(){i(this,t)}return r(t,[{key:"_setInstance",value:function(t){this._self=t}},{key:"_debug",value:function(){this._self.option.debug&&(window.console.group("VtexMinicart Debbug"),window.console.log(this._self.cart.items),window.console.groupEnd())}},{key:"_removeItem",value:function(t){var e=this;vtexjs.checkout.getOrderForm().then(function(n){e._addLoader();var i=n.items[t];return i.index=t,vtexjs.checkout.removeItems([i])}).done(function(t){e._self.fillCart(),e._removeLoader(),e._deleteItemEvent(t)})}},{key:"_updateItem",value:function(t,e){var n=this;vtexjs.checkout.getOrderForm().then(function(i){n._addLoader();var r={index:t,quantity:e};return vtexjs.checkout.updateItems([r],null,!1)}).done(function(e){n._self.fillCart(),n._removeLoader(),n._updateItemEvent(e,t)})}},{key:"_addLoader",value:function(){this._self.option.bodyClass&&$("body").addClass(this._self.option.bodyClass)}},{key:"_removeLoader",value:function(){this._self.option.bodyClass&&$("body").removeClass(this._self.option.bodyClass)}},{key:"_requestStartEvent",value:function(){var t=$.Event("vtexMinicart.requestStart");$(document).trigger(t)}},{key:"_requestEndEvent",value:function(t){var e=$.Event("vtexMinicart.requestEnd");$(document).trigger(e,[t])}},{key:"_updateItemEvent",value:function(t,e){var n=$.Event("vtexMinicart.update"),i=t.items[e];$(document).trigger(n,[t,e,i])}},{key:"_deleteItemEvent",value:function(t){var e=$.Event("vtexMinicart.delete");$(document).trigger(e,[t])}}]),t}()),o={cart:{items:{},itemCount:0},init:function(){a._setInstance(this),this.bindData(),this.fillCart(),this.updateItem(),this.removeItem()},bindData:function(){rivets.bind(this.$element,{controller:this,cart:this.cart})},fillCart:function(){var t=this;a._requestStartEvent(),vtexjs.checkout.getOrderForm().done(function(e){if(t.$element.find("[data-minicart-subtotal]").html(t.vtexHelpers.formatPrice(e.value)),t.cart.itemCount=e.items.length,t.cart.items=e.items,t.cart.itemCount>0){var n=e.items.reduce(function(t,e){return t+e.quantity},0);$("[data-minicart-amount]").text(n),e.items.map(function(e,n){vtexjs.catalog.getProductWithVariations(e.productId).done(function(i){var r=i.skus.filter(function(t){return parseInt(t.sku)===parseInt(e.id)});e.sellingPrice===e.listPrice&&(t.cart.items[n].listPrice=0),t.cart.items[n].imageUrl=t.globalHelpers.stripHttp(t.cart.items[n].imageUrl),t.cart.items[n].productInfo=i,t.cart.items[n].index=n,t.cart.items[n].availablequantity=r[0].availablequantity,t.cart.items[n].installments=r[0].installments,t.cart.items[n].installmentsInsterestRate=r[0].installmentsInsterestRate,t.cart.items[n].installmentsValue=r[0].installmentsValue,t.cart.items[n].variants=r[0].dimensions})}),a._debug()}else $("[data-minicart-amount]").text(0)}).always(function(t){a._requestEndEvent(t)})},removeItem:function(){$(document).on("click","[data-minicart-item-remove]",function(t){var e=$(t.currentTarget).data("minicartIndex");a._removeItem(e)})},updateItem:function(){$(document).on("click","[data-minicart-item-qty]",function(t){t.preventDefault();var e=$(t.currentTarget),n=e.parent().find("[data-minicart-item-qty-val]"),i=n.data("minicartIndex"),r=n.data("minicartAvailablequantity"),o=n.val(),s=0;if(r=r||99999,"+"===e.data("minicartItemQty")){if((s=parseFloat(o)+1)>parseInt(r))return!1}else if(o>0){if(0===(s=parseFloat(o)-1))return a._removeItem(i),!1}else s=0;a._updateItem(i,s)})}};$.fn.vtexMinicart=function(r){for(var a=this,s=arguments.length,l=Array(s>1?s-1:0),u=1;u<s;u++)l[u-1]=arguments[u];var c="object"===(void 0===r?"undefined":n(r))&&r;return this.each(function(n){var s,u=$(a),d=u.data("vtexMinicart");(d||u.data("vtexMinicart",d=new function n(r,a){if(i(this,n),this.option=$.extend({},e,a),null===this.option.vtexUtils)throw new Error(t.vtexUtils);if("@VtexUtils"!==this.option.vtexUtils.name)throw new Error(t.vtexUtils);if("boolean"!=typeof this.option.debug)throw new Error(t.debug);if(null!==this.option.bodyClass&&"string"!=typeof this.option.bodyClass)throw new Error(t.bodyClass);this.globalHelpers=this.option.vtexUtils.globalHelpers,this.vtexHelpers=this.option.vtexUtils.vtexHelpers,this.$element=$(r),this.globalHelpers.extend(n.prototype,o),this.init()}(a,c)),"string"==typeof r)&&(l.length>1?(s=d)[r].apply(s,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(Array.prototype.slice.call(l,1))):d[r]())})}}();