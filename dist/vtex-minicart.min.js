/*!!
 * VtexMinicart.js v0.5.5
 * https://github.com/zeindelf/vtex-minicart
 *
 * Copyright (c) 2017-2019 Zeindelf
 * Released under the MIT license
 *
 * Date: 2019-02-27T04:08:59.303Z
 */
!function(){"use strict";var i={vtexUtils:'VtexUtils.js is required and must be an instance. Download it from https://www.npmjs.com/package/vtex-utils and use option "vtexUtils: new VTEX.VtexUtils()".',vtexCatalog:'VtexCatalog.js is required. Download it from https://www.npmjs.com/package/vtex-catalog and use option "vtexCatalog: VTEX.VtexUtils" (not an instance).',debug:'Option debug should be a "boolean" value.',cache:'Option cache should be a "boolean" value.',bodyClass:'Option bodyClass should be a "string" value.'},o={vtexUtils:null,vtexCatalog:null,cache:!1,debug:!1,bodyClass:null,zeroPadding:!1,showGifts:!1,camelizeItems:!1,camelizeProps:!1},n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),l=new(function(){function t(){a(this,t)}return e(t,[{key:"_setInstance",value:function(t){this._self=t}},{key:"_debug",value:function(){this._self.option.debug&&(window.console.group("VtexMinicart Debbug"),window.console.log(this._self.cart.items),window.console.groupEnd())}},{key:"_removeItem",value:function(n){var i=this,e=vtexjs.checkout.orderForm.items[n];vtexjs.checkout.getOrderForm().then(function(t){i._addLoader();var e=t.items[n];return e.index=n,vtexjs.checkout.removeItems([e])}).done(function(t){i._self.fillCart(),i._removeLoader(),i._deleteItemEvent(t,e)})}},{key:"_updateItem",value:function(n,i){var o=this;vtexjs.checkout.getOrderForm().then(function(t){o._addLoader();var e={index:n,quantity:i};return vtexjs.checkout.updateItems([e],null,!1)}).done(function(t){o._self.fillCart(),o._removeLoader(),o._updateItemEvent(t,n)})}},{key:"_addLoader",value:function(){this._self.option.bodyClass&&$("body").addClass(this._self.option.bodyClass)}},{key:"_removeLoader",value:function(){this._self.option.bodyClass&&$("body").removeClass(this._self.option.bodyClass)}},{key:"_setPadding",value:function(t){return this._self.option.zeroPadding?this._self.globalHelpers.pad(t):t}},{key:"_requestStartEvent",value:function(){var t=$.Event("requestStart.vtexMinicart");$(document).trigger(t)}},{key:"_requestEndEvent",value:function(t){var e=$.Event("requestEnd.vtexMinicart");$(document).trigger(e,[t])}},{key:"_updateItemEvent",value:function(t,e){var n=$.Event("update.vtexMinicart"),i=t.items[e];$(document).trigger(n,[t,e,i])}},{key:"_deleteItemEvent",value:function(t,e){var n=$.Event("delete.vtexMinicart");$(document).trigger(n,[t,e])}}]),t}()),r={cart:{items:{},itemCount:0},init:function(){l._setInstance(this),this.bindData(),this.fillCart(),this.updateItem(),this.removeItem()},bindData:function(){rivets.bind(this.$element,{controller:this,cart:this.cart})},fillCart:function(){var s=this;l._requestStartEvent(),vtexjs.checkout.getOrderForm().done(function(t){var e=t.items;s.option.showGifts||(e=e.filter(function(t){return!t.isGift}));var n=s.globalHelpers.objectSearch(t.totalizers,{id:"Items"});if(s.$element.find("[data-minicart-subtotal]").html(s.vtexHelpers.formatPrice(n.value||0)),s.cart.itemCount=e.length,s.cart.items=e,0<s.cart.itemCount){var i=e.reduce(function(t,e){return t+e.quantity},0);$("[data-minicart-amount]").text(l._setPadding(i));for(var o=function(n,t){var i=e[n];i.sellingPrice===i.listPrice&&(s.cart.items[n].listPrice=0),s.cart.items[n].imageUrl=s.globalHelpers.stripHttp(s.cart.items[n].imageUrl),s.cart.items[n].index=n,$.ajax({url:"/api/catalog_system/pub/products/search?fq=productId:"+i.productId}).then(function(t){var e=[];t.length&&(e=t[0].items.filter(function(t){return parseInt(t.itemId,10)===parseInt(i.id,10)})),s.cart.items[n].productFullInfo=t[0],s.cart.items[n].productSkuSearch=e[0]}),vtexjs.catalog.getProductWithVariations(i.productId).done(function(t){var e=t.skus.filter(function(t){return parseInt(t.sku,10)===parseInt(i.id,10)});s.cart.items[n].productSkuVariations=s.option.camelizeItems?s.globalHelpers.camelize(e[0]):e[0]})},a=0,r=e.length;a<r;a+=1)o(a);l._debug()}else $("[data-minicart-amount]").text(l._setPadding(0))}).always(function(t){l._requestEndEvent(t)})},removeItem:function(){$(document).on("click","[data-minicart-item-remove]",function(t){var e=$(t.currentTarget).data("minicartIndex");l._removeItem(e)})},updateItem:function(){$(document).on("click","[data-minicart-item-qty]",function(t){t.preventDefault();var e=$(t.currentTarget),n=e.parent().find("[data-minicart-item-qty-val]"),i=n.data("minicartIndex"),o=n.data("minicartAvailablequantity"),a=n.val(),r=0;if(o=o||99999,"+"===e.data("minicartItemQty")){if((r=parseFloat(a)+1)>parseInt(o))return!1}else if(0<a){if(0===(r=parseFloat(a)-1))return l._removeItem(i),!1}else r=0;l._updateItem(i,r)})}},u=function t(e,n){if(a(this,t),this.option=$.extend({},o,n),null===this.option.vtexUtils)throw new Error(i.vtexUtils);if("@VtexUtils"!==this.option.vtexUtils.name)throw new Error(i.vtexUtils);if("boolean"!=typeof this.option.debug)throw new Error(i.debug);if("boolean"!=typeof this.option.cache)throw new Error(i.cache);if(null!==this.option.bodyClass&&"string"!=typeof this.option.bodyClass)throw new Error(i.bodyClass);this.globalHelpers=this.option.vtexUtils.globalHelpers,this.vtexHelpers=this.option.vtexUtils.vtexHelpers,this.vtexCatalog=new this.option.vtexCatalog(this.option.vtexUtils,this.option.cache),this.vtexCatalog.setCamelize(this.option.camelizeItems,this.option.camelizeProps),this.$element=$(e),this.globalHelpers.extend(t.prototype,r),this.init()};$.fn.vtexMinicart=function(o){for(var a=this,t=arguments.length,r=Array(1<t?t-1:0),e=1;e<t;e++)r[e-1]=arguments[e];var s="object"===(void 0===o?"undefined":n(o))&&o;return this.each(function(t){var e,n=$(a),i=n.data("vtexMinicart");(i||n.data("vtexMinicart",i=new u(a,s)),"string"==typeof o)&&(1<r.length?(e=i)[o].apply(e,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(Array.prototype.slice.call(r,1))):i[o]())})}}();