/*!!
 * VtexMinicart.js v0.4.0
 * https://github.com/zeindelf/vtex-minicart
 *
 * Copyright (c) 2017-2018 Zeindelf
 * Released under the MIT license
 *
 * Date: 2018-03-04T04:34:04.662Z
 */
!function(){"use strict";var t="1.1.0",e={messages:{vtexUtils:'VtexUtils.js is required and must be an instance. Download it from https://www.npmjs.com/package/vtex-utils and use option "vtexUtils: new VTEX.VtexUtils()".',vtexUtilsVersion:t,vtexUtilsVersionMessage:"VtexUtils version must be higher than 1.1.0. Download last version on https://www.npmjs.com/package/vtex-utils",vtexCatalog:'VtexCatalog.js is required. Download it from https://www.npmjs.com/package/vtex-catalog and use option "vtexCatalog: VTEX.VtexUtils" (not an instance).',debug:'Option debug should be a "boolean" value.',cache:'Option cache should be a "boolean" value.',bodyClass:'Option bodyClass should be a "string" value.'}},n={vtexUtils:null,vtexCatalog:null,cache:!1,debug:!1,bodyClass:null,zeroPadding:!1},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=new(function(){function t(){o(this,t)}return a(t,[{key:"_setInstance",value:function(t){this._self=t}},{key:"_debug",value:function(){this._self.option.debug&&(window.console.group("VtexMinicart Debbug"),window.console.log(this._self.cart.items),window.console.groupEnd())}},{key:"_removeItem",value:function(t){var e=this;vtexjs.checkout.getOrderForm().then(function(n){e._addLoader();var i=n.items[t];return i.index=t,vtexjs.checkout.removeItems([i])}).done(function(t){e._self.fillCart(),e._removeLoader(),e._deleteItemEvent(t)})}},{key:"_updateItem",value:function(t,e){var n=this;vtexjs.checkout.getOrderForm().then(function(i){n._addLoader();var o={index:t,quantity:e};return vtexjs.checkout.updateItems([o],null,!1)}).done(function(e){n._self.fillCart(),n._removeLoader(),n._updateItemEvent(e,t)})}},{key:"_addLoader",value:function(){this._self.option.bodyClass&&$("body").addClass(this._self.option.bodyClass)}},{key:"_removeLoader",value:function(){this._self.option.bodyClass&&$("body").removeClass(this._self.option.bodyClass)}},{key:"_setPadding",value:function(t){return this._self.option.zeroPadding?this._self.globalHelpers.pad(t):t}},{key:"_requestStartEvent",value:function(){var t=$.Event("requestStart.vtexMinicart");$(document).trigger(t)}},{key:"_requestEndEvent",value:function(t){var e=$.Event("requestEnd.vtexMinicart");$(document).trigger(e,[t])}},{key:"_updateItemEvent",value:function(t,e){var n=$.Event("update.vtexMinicart"),i=t.items[e];$(document).trigger(n,[t,e,i])}},{key:"_deleteItemEvent",value:function(t){var e=$.Event("delete.vtexMinicart");$(document).trigger(e,[t])}}]),t}()),s={cart:{items:{},itemCount:0},init:function(){r._setInstance(this),this.bindData(),this.fillCart(),this.updateItem(),this.removeItem()},bindData:function(){rivets.bind(this.$element,{controller:this,cart:this.cart})},fillCart:function(){var t=this;r._requestStartEvent(),vtexjs.checkout.getOrderForm().done(function(e){if(t.$element.find("[data-minicart-subtotal]").html(t.vtexHelpers.formatPrice(e.value)),t.cart.itemCount=e.items.length,t.cart.items=e.items,t.cart.itemCount>0){var n=e.items.reduce(function(t,e){return t+e.quantity},0);$("[data-minicart-amount]").text(r._setPadding(n));for(var i=function(n,i){var o=e.items[n];o.sellingPrice===o.listPrice&&(t.cart.items[n].listPrice=0),t.cart.items[n].imageUrl=t.globalHelpers.stripHttp(t.cart.items[n].imageUrl),t.cart.items[n].index=n,t.vtexCatalog.searchProduct(o.productId).then(function(e){var i=e.items.filter(function(t){return parseInt(t.itemId,10)===parseInt(o.id,10)});t.cart.items[n].productFullInfo=e,t.cart.items[n].productSkuSearch=i[0]}),vtexjs.catalog.getProductWithVariations(o.productId).done(function(e){var i=e.skus.filter(function(t){return parseInt(t.sku,10)===parseInt(o.id,10)});t.cart.items[n].productSkuVariations=i[0]})},o=0,a=e.items.length;o<a;o+=1)i(o);r._debug()}else $("[data-minicart-amount]").text(r._setPadding(0))}).always(function(t){r._requestEndEvent(t)})},removeItem:function(){$(document).on("click","[data-minicart-item-remove]",function(t){var e=$(t.currentTarget).data("minicartIndex");r._removeItem(e)})},updateItem:function(){$(document).on("click","[data-minicart-item-qty]",function(t){t.preventDefault();var e=$(t.currentTarget),n=e.parent().find("[data-minicart-item-qty-val]"),i=n.data("minicartIndex"),o=n.data("minicartAvailablequantity"),a=n.val(),s=0;if(o=o||99999,"+"===e.data("minicartItemQty")){if((s=parseFloat(a)+1)>parseInt(o))return!1}else if(a>0){if(0===(s=parseFloat(a)-1))return r._removeItem(i),!1}else s=0;r._updateItem(i,s)})}};$.fn.vtexMinicart=function(t){for(var a=this,r=arguments.length,l=Array(r>1?r-1:0),u=1;u<r;u++)l[u-1]=arguments[u];var c="object"===(void 0===t?"undefined":i(t))&&t;return this.each(function(i){var r,u=$(a),d=u.data("vtexMinicart");(d||u.data("vtexMinicart",d=new function t(i,a){if(o(this,t),this.option=$.extend({},n,a),null===this.option.vtexUtils)throw new Error(e.messages.vtexUtils);if("@VtexUtils"!==this.option.vtexUtils.name)throw new Error(e.messages.vtexUtils);if(this.option.vtexUtils.version<e.messages.vtexUtilsVersion)throw new Error(e.messages.vtexUtilsVersionMessage);if("boolean"!=typeof this.option.debug)throw new Error(e.messages.debug);if("boolean"!=typeof this.option.cache)throw new Error(e.messages.cache);if(null!==this.option.bodyClass&&"string"!=typeof this.option.bodyClass)throw new Error(e.messages.bodyClass);this.globalHelpers=this.option.vtexUtils.globalHelpers,this.vtexHelpers=this.option.vtexUtils.vtexHelpers,this.vtexCatalog=new this.option.vtexCatalog(this.option.vtexUtils,this.option.cache),this.$element=$(i),this.globalHelpers.extend(t.prototype,s),this.init()}(a,c)),"string"==typeof t)&&(l.length>1?(r=d)[t].apply(r,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(Array.prototype.slice.call(l,1))):d[t]())})}}();